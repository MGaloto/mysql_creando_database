---
title: "Coder House"
author: "Maximiliano Galoto"
subtitle: "Avances del Proyecto Final"
output:
 prettydoc::html_pretty:
    theme: lumen
    highlight: github
    toc: true
    toc_depth: 2
    math: katex



---




<br>
</br>


```{css my-header-colors, echo = FALSE}
.page-header {
    background-image: linear-gradient(200deg, black, black);
}


```




<style type="text/css">

.toc .toc-box {
    padding: 1.5rem;
    background-color: #d4cfcf;
    border: solid 1px #d4cfcf;
    border-radius: .3rem;
}

a {
    color: black;
    text-decoration: none;
}

.main-content h1, .main-content h2, .main-content h3, .main-content h4, .main-content h5, .main-content h6 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 400;
    color: black;
}


.main-content table th {
    font-weight: 700;
    background-color: yellow;
    color: black;
}


h1.title {
  font-size: 58px;
  color: yellow;
  text-align: center;
}
h3.subtitle { 
    font-size: 28px;
  font-family: "Times New Roman", Times, serif;
  color: yellow ;
  text-align: center;
}
h4.author { 
    font-size: 22px;
  font-family: "Times New Roman", Times, serif;
  color:yellow ;
  text-align: center;
}

</style>

<br>
</br>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tinytex)


# app.diagrams.net

```

<div style="text-align: center">
# 1 - Descripcion del proyecto
</div>



<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>

<br>
</br>

 **_Temática para el trabajo final:_**

Diagrama de Entidad de Relación de una _Empresa de Medicina Prepaga_.


<br>
</br>

<div style="text-align: center">
# 2 - Descripción de las tablas
</div>


<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>

<br>
</br>

**_Tablas, descripción y atributos:_**

A continuación se detallaran cada una de las tablas que componen el DER con sus atributos y descripciones:

<br>
</br>


| $$ \textbf{Tabla: Afiliado }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Afiliado$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Nombre$$     | $$VARCHAR(50) \:NOT \:NULL  $$         |
| $$ Apellido$$     | $$VARCHAR(50) \:NOT \:NULL  $$         | 
| $$ Email$$     | $$VARCHAR(50) \:NOT \:NULL  $$         | 
| $$ Telefono$$     | $$INT \:NOT \:NULL  $$         | 
| $$ Fecha\:Nacimiento$$     | $$DATE \:NOT \:NULL$$        | 
| $$ Domicilio$$     | $$VARCHAR(50) \:NOT \:NULL  $$            | 
| $$ Ocupacion$$     | $$VARCHAR(50) \:NOT \:NULL  $$            | 
| $$ Estado\:Civil$$     | $$VARCHAR(50) \:NOT \:NULL  $$            | 
| $$ Plan$$     | $$VARCHAR(50) \:NOT \:NULL  $$            | 
| $$ Plan$$     | $$VARCHAR(50) \:NOT \:NULL  $$            | 
| $$ Dni$$     | $$INT \:NOT \:NULL  $$            | 


_Esta tabla contiene los atributos de los afiliados a la empresa de medicina prepaga, podemos observar el ID como Primary Key, Nombre, Apellido, Fecha de Nacimiento, Domicilio, Ocupación y Estado Civil. Estos datos salen del transaccional cuando el afiliado se da de alta en nuestro sistema. _

<br>
</br>


| $$ \textbf{Tabla: Especialidad }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Especialidad$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Especialidad$$     | $$VARCHAR(50) \:NOT \:NULL  $$         | 


_Esta tabla contiene las diferentes prestaciones que proveen los distintos centros médicos._

<br>
</br>
  

| $$ \textbf{Tabla: Medico }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Medico$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Nombre$$     | $$VARCHAR(50) \:NOT \:NULL  $$         |
| $$ Apellido$$     | $$VARCHAR(50) \:NOT \:NULL  $$         | 
| $$ Fecha\:Nacimiento$$     | $$DATE \:NOT \:NULL$$        | 
| $$ Domicilio$$     | $$VARCHAR(50) \:NOT \:NULL  $$            | 
| $$ Telefono$$     | $$INT \:NOT\: NULL  $$            | 

_Esta tabla contiene los datos de los médicos que prestan su servicio a distintos centros médicos._

<br>
</br>

| $$ \textbf{Tabla: Plan Familiar }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Plan\:Familiar$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Tipo$$     | $$VARCHAR(50) \:NOT \:NULL  $$         |
| $$ Fecha\:Alta$$     | $$DATE \:NOT \:NULL $$         | 
| $$ Total\:Consultas$$     | $$INT \:NOT \:NULL  $$         | 


<br>
</br>


| $$ \textbf{Tabla: Centro Medico }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Centro$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Nombre$$     | $$VARCHAR(50) \:NOT \:NULL  $$         |
| $$ Dirección$$     | $$VARCHAR(50) \:NOT \:NULL  $$         | 
| $$ Teléfono$$     | $$INT \:NOT \:NULL$$        | 
| $$ Cod Postal$$     | $$INT \:NOT \:NULL$$        | 
| $$ Email$$     | $$VARCHAR(50) \:NOT \:NULL  $$         | 

<br>
</br>


| $$ \textbf{Tabla: Consulta }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Consulta$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Consulta$$     | $$VARCHAR(50) \:NOT \:NULL  $$         |
| $$ Diagnostico$$     | $$VARCHAR(50) \:NOT \:NULL  $$         |


<br>
</br>


| $$ \textbf{Tabla: Turnos }$$ |
|$$ \textbf{Atributos}$$ | $$ \textbf{Descripcion}$$ | 
|-------|------------|
| $$ Id\:Turno$$     |   $$INT \:NOT\: NULL\: PRIMARY \:KEY\: AUTO\:INCREMENT$$         | 
| $$ Fecha$$     | $$DATE \:NOT \:NULL  $$         |
| $$ Id\: Medico$$     | $$INT \:NOT\: NULL\: FOREIGN \:KEY $$            | 
| $$ Id\: Especialidad$$     | $$INT \:NOT\: NULL\: FOREIGN \:KEY $$            | 
| $$ Id\: Afiliado$$     | $$INT \:NOT\: NULL\: FOREIGN \:KEY $$            | 
| $$ Id\: Consulta$$     | $$INT \:NOT\: NULL\: FOREIGN \:KEY $$            | 
| $$ Id\:Plan\:Familiar$$     |   $$INT \:NOT\: NULL\: FOREIGN \:KEY $$         | 
| $$ Id\:Centro$$     |   $$INT \:NOT\: NULL\: FOREIGN \:KEY $$         | 







_Esta tabla conecta el medico y el paciente, donde podemos ver la consulta, la fecha y el diagnostico. Cada turno tiene un Id._


<br>
</br>

<div style="text-align: center">
# 3 - Diagrama Entidad de Relacion
</div>


<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>


<br>
</br>

![](DER.png)

<br>
</br>

![](REVERSE.png)

<br>
</br>

<div style="text-align: center">
# 4 - Codigo MySql desde Python
</div>

<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>


<br>
</br>


[Github Codigo](https://github.com/MGaloto/mysql_creando_database/blob/main/database.py)

<br>
</br>

<div style="text-align: center">
# 5 - Inserción de datos
</div>

<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>


<br>
</br>


**_Metodologia utilizada:_**

Los valores en cada una de las tablas se insertaron desde archivos .csv.

Los archivos son los siguientes:



![](imagenes/archivos.png)

  
_Cada una de las tablas contiene 10 observaciones_


_Ejemplo tabla afiliados:_


![](imagenes/afiliado.png)


A continuación se adjuntan scripts de los pasos para importar los datos y MySql final:

![](imagenes/import.png){width=70%}


![](imagenes/script_medico.png){width=70%}



![](imagenes/base_datos.png)

<div style="text-align: center">
# 6 - Vistas
</div>



<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>




**_A continuación se adjuntan los scripts de las 5 vistas_**

_El código SQL de las vistas se encuentra en el siguiente link:_ [Github Codigo](https://github.com/MGaloto/mysql_creando_database/blob/main/database.py)


<ul>

<br>
</br>

**_1) Vista 1:_**


_Consulta y Diagnostico por Afiliado_

_Esta vista permite guardarnos en una tabla aparte todos los turnos solicitados por los afiliados dados de alta en el sistema. Esta vista nos sirve para estar actualizados de los ultimos turnos ya que esta ordenada por fecha._


![](imagenes/vista1.png)
<br>
</br>
<br>
</br>



**_2) Vista 2_**

_Que medico atendió a cada paciente:_

_Esta vista creada nos sirve para visualizar forma rapida mediante su consulta sobre que medicos atendieron a que paciente en determinada fecha._

![](imagenes/vista2.png)
<br>
</br>
<br>
</br>

**_3) Vista 3_**

_Que medico atiende en cada centro medico:_

_Esta vista permite que podamos visualizar de forma rapida que medicos atienden en los centros medicos._

![](imagenes/vista3.png)
<br>
</br>
<br>
</br>

**_4) Vista 4_**

_Plan familiar por afiliado:_


_Esta vista nos permite ver de nuestra base de datos que plan familiar tiene cada uno de los afiliados._

![](imagenes/vista4.png)
<br>
</br>
<br>
</br>

**_5) Vista 5_**



_Cantidad de centros médicos por especialidad:_

_Vista que nos permite obtener de forma rapida y sencilla la especialidad de cada centro medico de nuesta base de datos._

![](imagenes/vista5.png)
<br>
</br>
<br>
</br>


</ul>




<div style="text-align: center">
# 7 - Funciones
</div>


<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>


<br>
</br>




<ul>


Por definición es importante indicar que una función es un conjunto de instrucciones SQL que realizan una tarea específica de manera automática. Una función acepta entradas en forma de parámetros y devuelve un valor.


**_A continuación se adjuntan los scripts de las funcioness_**




**_1) Función 1:_**


_Función donde ingresamos un CHAR y nos devuelve un NUMERIC_

_Ingresamos el diagnostico y nos regresa el porcentaje de pacientes con el diagnostico ingresado de nuestra base de datos_

_En la parte inferior de la imagen adjunta se puede ver el resultado de la función una vez ingresado un CHAR._

![](imagenes/funcion1.png)
<br>
</br>
<br>
</br>


**_2) Función 2:_**


_Función donde ingresamos un CHAR y nos devuelve un NUMERIC_

_Ingresamos el plan familiar y nos regresa el porcentaje de afiliados con el plan familiar ingresado de nuestra base de datos_

_En la parte inferior de la imagen adjunta se puede ver el resultado de la función una vez ingresado un CHAR._

![](imagenes/funcion2.png)
<br>
</br>
<br>
</br>

</ul>


<div style="text-align: center">
# 8 - Stored Procedures
</div>


<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>


<br>
</br>


<ul>


Un stored procedure es un programa (o procedimiento) almacenado físicamente en una base de datos. Su implementación varía de un gestor de bases de datos a otro. La ventaja de un procedimiento almacenado es que al ser ejecutado, en respuesta a una petición de usuario, es ejecutado directamente en el motor de bases de datos, el cual usualmente corre en un servidor separado. Como tal, posee acceso directo a los datos que necesita manipular y sólo necesita enviar sus resultados de regreso al usuario, deshaciéndose de la sobrecarga resultante de comunicar grandes cantidades de datos salientes y entrantes.


**_A continuación se adjuntan los scripts de los Stored Procedures_**




**_1) Stored Procedure 1:_**


_En el siguiente Stored Procedure se ejecuta un comando que ordena una variable de forma descendente o ascendente. Los parametros permiten elegir el orden, la tabla y la variable._


![](imagenes/sp1.png)
<br>
</br>
<br>
</br>


**_2) Stored Procedure 2:_**


_El siguiente Stored Procedure ejecuta un comando para actualizar la tabla Turnos._


![](imagenes/sp2.png)
<br>
</br>
<br>
</br>

</ul>



<div style="text-align: center">
# 9 - Triggers
</div>


<div style="text-align: right">
 <a href="#top">Volver al Inicio</a>
</div>

<br>
</br>


<ul>


Un disparador o trigger es una funcionalidad que la base de datos ejecuta de forma automática cuando se realiza una operación de tipo Insert, Update o Delete en una tabla o vista, o cuando se ejecuta una consulta SQL sobre una tabla o vista.

**_A continuación se adjuntan los scripts de los Triggers_**




**_1) Triggers 1:_**


_En el siguiente Trigger se crea un log para la tabla afiliados y antes de que se completen los nuevos valores para la tabla afiliados se completan en la tabla de logs con fecha, usuario, id y tipo de operación._

_Lo contrario sucede con la próxima imagen que es un Before._

![](imagenes/triggeraft1.png)
<br>
</br>
<br>
</br>

![](imagenes/triggerbef1.png)

<br>
</br>
<br>
</br>

**_2) Triggers 2:_**


_En el siguiente Trigger se crea un log para la tabla consulta y antes de que se completen los nuevos valores para la tabla se completan en la tabla de logs con fecha, usuario, id y tipo de operación._

_Lo contrario sucede con la próxima imagen que es un Before._


![](imagenes/triggeraft2.png)


<br>
</br>
<br>
</br>

![](imagenes/triggerbef2.png)

<br>
</br>
<br>
</br>


</ul>